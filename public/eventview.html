<!DOCTYPE html>

<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>Single Event View</title>
      <link rel="stylesheet" href="style.css">
      <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
      <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
      <script
        src="https://code.jquery.com/jquery-3.1.1.min.js"
        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
        crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<style>

.active{
  font-weight: bold;
}
.fas{
  color: white;
  text-shadow: 1px 1px 1px #ccc;
  font-size: 35px;
}


ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: #81CFE0;
}

li {
    float: left;
}

li a {
    display: block;
    color: white;
    text-align: center;
    padding: 18px 16px;
    text-decoration: none;
    font-size: 15px;
    font-family: "Roboto", sans-serif;


}

li a:hover {
    background-color: grey;
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}



.btn-size{
  width: 100px;
  border-radius: 12px;
   background-color: #81CFE0;
    border: none;
    color: white;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    font-family: 'Raleway';
    font-weight: bold;

}

.btn-size:hover {
    background-color: #555555;
    color: white;
    font-weight: 100;
}
.comment{
  font-weight: 100;
  font-size: 17px;
}

#comment{
  font-size: 15px;
  font-weight: 100;

}
#hi{
  font-family: 'Raleway';
  font-size: 40px;
  background-color: #81CFE0;
  color: white;
  font-weight: bold;
}
#hi2{
  font-family: 'Raleway';
  font-size: 30px;
  background-color: #313335;
  color: white;
  font-weight: bold;
}
#detail{
    font-family: 'Lato';
    border:2px solid white;
    color: #313335;
    font-weight: 400;
    font-size: 16px;


}


@import url(https://fonts.googleapis.com/css?family=Lato:400,900);
@import url(https://fonts.googleapis.com/css?family=Raleway:400,900);


html,body {
  font-family: 'Lato', sans-serif;
  height: 100%;
  margin: 0px;

}
h1 {
  font-weight: 100px;
  font-size: 60px;
  color:white;
  background-color:  #81CFE0;
  margin: 0px;
  border: 2px solid white

}

.event a {
  display: inline-block;
  width: 700px;
  padding: 10px;
  border: 1px solid #81CFE0;
  border-radius: 25px;
  margin: 0 0 10px 0;
  text-decoration: none;
  color: black;
}
.event a:hover {
  background: #eee;
}

.event a span:first-child {
  font-weight: 900;
}


.active{
  font-weight: bold;
}
.fas{
  color: white;
  text-shadow: 1px 1px 1px #ccc;
  font-size: 40px;
}


ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: #81CFE0;
}

li {
    float: left;
}

li a {
    display: block;
    color: white;
    text-align: center;
    padding: 18px 16px;
    text-decoration: none;
    font-size: 15px;
    font-family: "Roboto", sans-serif;


}

#comment2{
  padding-left: 50px;
}

li a:hover {
    background-color: grey;
}



</style>

</head>
<body>

  <ul>

    <li><a class="active" href="#home"><img src="calendar.png" width="30"> <br> EVENTFEELER  </img> </a></li>
    <li><a href="index2.html"><i class="fas fa-home"> </i></a></li>
    <li><a href="maptest.html"><i class="fas fa-map-marker-alt"></i></a></li>
    <li><a href="#searchpage"><i class="fas fa-search"></i></a></li>
    <li><a href="#recommendations"><i class="fas fa-thumbs-up"></i></a></li>

  </ul>
  <div id="root"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react-dom.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.12.0/axios.min.js"></script>
  <script src="https://npmcdn.com/babel-core@5.8.38/browser.min.js"></script>
  <script src="qs.js"></script>


<script type="text/babel">

class EventData extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      users:[],
      count: 0
    };

  }
  componentDidMount() {
    var queries = qs.get();
    console.log(queries.eventid);
    axios
      .get('/api/event/'+queries.eventid)
      .then(response => {
        this.setState({ users: response.data }, function () {
          console.log(this.state.users);
        });
      });
  }

  render() {
    return (

    <center><div id ="detail"> <div id="hi"> {this.state.users.name}</div> < br />
  <font size="4">  <strong>Event Description: </strong> </font><br /> {this.state.users.description} < br /><br />
  <font size="4">       <strong>   Location: </strong> </font><br /> {this.state.users.place && this.state.users.place.name} <br /><br />
  <font size="4">     <strong>     Categories:  </strong> </font><br /> {this.state.users && this.state.users.categories}<br /><br />
  <font size="4">     <strong>     Time & Date: </strong>  </font><br /> {this.state.users && this.state.users.event_times&& this.state.users.event_times[0].start_time} figure out how to change to utc<br />
  < br/><br/><div id="hi2"> Comments</div>
<CommentForm /> <Comments />
     </div></center>
    );
  }
}


var Comments = React.createClass({

  getInitialState: function() {
    return {
      events: []
    }
  },

  componentDidMount: function() {

    var queries = qs.get();

    var last_week = new Date();
    last_week.setDate(last_week.getDate() - 7);
    var th = this;
    this.serverRequest =
      axios.get('/api/search/comments?event_id='+queries.eventid)
        .then(function(result) {
          th.setState({
            events: result.data
          });
        })
  },

  componentWillUnmount: function() {
    this.serverRequest.abort();
  },

  render: function() {
    return (
      <div>
        {this.state.events.map(function(event) {
          var url = 'eventview.html?eventid='+event._id;
          var userinfo = '';
          // var userInfo = axios.get('api/user/'+event.user_id)
          //   .then(function (response) {
          //     console.log(response.data.twitter.username);
          //     username = response.data.twitter.username;
          //     console.log(username);
          //   })
          //   .catch(function (error) {
          //     console.log(error);
          //   });
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              userinfo =  this.responseText;
              console.log(userinfo);
            }
          };
          xhttp.open("GET", 'api/user/'+event.user_id, false);
          xhttp.send();
          var info = JSON.parse(userinfo);
          var link = String(info["twitter"].image_url);
          return (
            <div key={event.url} className="event">
              <a href={url} >

           <img src ={link}></img>

<b> {info["twitter"].display_name}</b> @{info["twitter"].username} {event.comment_time} <br/><br/>
        <div id ="comment2">  {event.text}</div><br/>
              </a>
            </div>
          );
        })}
      </div>
    )
  }
});


class CommentForm extends React.Component {
  constructor(props) {
    super(props);
    this.state = {value: 'Comment on this event here'};
    this.id = qs.get().eventid;
    console.log(this.id);
    this.handleChange = this.handleChange.bind(this);
    this.handleSubmit = this.handleSubmit.bind(this);
  }

  handleChange(event) {
    this.setState({value: event.target.value});
  }

  handleSubmit(event) {
    alert('A comment was submitted: ' + this.state.value);
    console.log('this.id: '+this.id);
    console.log('this.state.value: '+this.state.value);
//     fetch('api/comment/', {
//   method: 'POST',
//   headers: {
//     Accept: 'application/json',
//     'Content-Type': 'application/json',
//   },
//   body: ({
//     text: this.state.value,
//     event_id: this.id,
//   }),
// });
var http = new XMLHttpRequest();
var url = 'api/comment/';
var params = "text="+ String(this.state.value)+"&event_id="+String(this.id);
http.open("POST", url, true);

//Send the proper header information along with the request
http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

http.onreadystatechange = function() {//Call a function when the state changes.
  if(http.readyState == 4 && http.status == 200) {
      alert(http.responseText);
  }
}
http.send(params);

    event.preventDefault();
  }

  render() {
    return (

<center>    <div class="comment"><br /></div>
      <form onSubmit={this.handleSubmit}>
        <label for='comment'>
                <textarea class="form-control" rows="5" cols ="60" id="comment" input type="text"  value={this.state.value} onChange={this.handleChange} ></textarea>
        </label><br />

   <button type="submit"  className="btn btn-size">Submit</button></form> </center>
    );
  }
}

ReactDOM.render(<div><EventData /></div>, document.getElementById("root"));
</script>



</body>

</html>
